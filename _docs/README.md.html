<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "README.md", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#systemhealth">Systemhealth</a>
      </div>
      <div class="heading h2">
        <a href="#install">Install</a>
      </div>
      <div class="heading h2">
        <a href="#initialize">Initialize</a>
      </div>
      <div class="heading h2">
        <a href="#methods">Methods</a>
      </div>
      <div class="heading h4">
        <a href="#.start()">.start()</a>
      </div>
      <div class="heading h4">
        <a href="#.stop()">.stop()</a>
      </div>
      <div class="heading h4">
        <a href="#.die()">.die()</a>
      </div>
      <div class="heading h4">
        <a href="#.resurrect()">.resurrect()</a>
      </div>
      <div class="heading h4">
        <a href="#.getstate()">.getState()</a>
      </div>
      <div class="heading h2">
        <a href="#events">Events</a>
      </div>
      <div class="heading h4">
        <a href="#started">started</a>
      </div>
      <div class="heading h4">
        <a href="#stopped">stopped</a>
      </div>
      <div class="heading h4">
        <a href="#died">died</a>
      </div>
      <div class="heading h4">
        <a href="#resurrected">resurrected</a>
      </div>
      <div class="heading h4">
        <a href="#checked">checked</a>
      </div>
      <div class="heading h2">
        <a href="#example">Example</a>
      </div>
      <div class="heading h2">
        <a href="#properties">Properties</a>
      </div>
      <div class="heading h4">
        <a href="#alive">alive</a>
      </div>
      <div class="heading h4">
        <a href="#hb">hb</a>
      </div>
      <div class="heading h2">
        <a href="#release%20history">Release History</a>
      </div>
      <div class="heading h2">
        <a href="#other%20projects">Other projects</a>
      </div>
      <div class="heading h2">
        <a href="#the%20mit%20license%20(mit)">The MIT License (MIT)</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="docs markdown">
<div class="pilwrap" id="systemhealth">
  <h1>
    <a href="#systemhealth" name="systemhealth" class="pilcrow">&#182;</a>
    Systemhealth
  </h1>
</div>


<p><a href="http://travis-ci.org/mpneuried/systemhealth"><img src="https://secure.travis-ci.org/mpneuried/systemhealth.png?branch=master" alt="Build Status" title="" /></a>
<a href="https://david-dm.org/mpneuried/systemhealth"><img src="https://david-dm.org/mpneuried/systemhealth.png" alt="Build Status" title="" /></a>
<a href="http://badge.fury.io/js/systemhealth"><img src="https://badge.fury.io/js/systemhealth.png" alt="NPM version" title="" /></a></p>

<p>Node module to run simple custom checks for your machine or it's connections. It will use <a href="https://github.com/mpneuried/redis-heartbeat">redis-heartbeat</a> to send the current state to redis.</p>


<div class="pilwrap" id="install">
  <h2>
    <a href="#install" name="install" class="pilcrow">&#182;</a>
    Install
  </h2>
</div>



<div class="highlight"><pre><code>  npm install systemhealth
</code></pre></div>




<div class="pilwrap" id="initialize">
  <h2>
    <a href="#initialize" name="initialize" class="pilcrow">&#182;</a>
    Initialize
  </h2>
</div>



<div class="highlight"><pre><code>  <span class="kd">var</span> <span class="nx">Systemhealth</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s2">&quot;systemhealth&quot;</span> <span class="p">);</span>
  <span class="kd">var</span> <span class="nx">health</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Systemhealth</span><span class="p">(</span> <span class="p">{</span> <span class="nx">identifier</span><span class="o">:</span> <span class="s2">&quot;my-server-name&quot;</span> <span class="p">},</span> <span class="p">[</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span> <span class="s2">&quot;bar&quot;</span> <span class="p">],</span> <span class="nx">require</span><span class="p">(</span> <span class="s2">&quot;./mychecks&quot;</span> <span class="p">)</span> <span class="p">)</span>
</code></pre></div>



<p><strong>Options</strong> </p>

<ul>
<li><strong>identifier</strong> : <em>( <code>String|Function</code> required )</em> The heartbeat identifier content as string or function. Passed directly to <code>redis-heartbeat</code></li>
<li><p><strong>name</strong> : <em>( <code>String</code> optional: default = <code>os.hostname()</code> )</em> A server type name. Default is the host name. Passed directly to `redis-heartbeat</p></li>
<li><p><strong>interval</strong> : <em>( <code>Number</code> optional: default = <code>60</code> )</em> Check interval in seconds</p></li>
<li><strong>intervalVariance</strong> : <em>( <code>Number</code> optional: default = <code>0</code> )</em> If you are using the same configuration for multiple servers you can define a variance that will add random seconds to the interval until this value.</li>
<li><strong>failCount</strong> : <em>( <code>Number</code> optional: default = <code>2</code> )</em> Count of failed checks per check until "die". E.g. Mark server as dead until 2 failed checks of the sql connection.</li>
<li><strong>successCount</strong> : <em>( <code>Number</code> optional: default = <code>1</code> )</em> Count of successful checks until the server resurrect. </li>
<li><p><strong>failTimeout</strong> : <em>( <code>Number</code> optional: default = <code>2000</code> )</em> Internal check timeout to wait for answers of check tasks</p></li>
<li><p><strong>host</strong> : <em>( <code>String</code> optional: default = <code>localhost</code> )</em> Redis host name. Passed directly to <code>redis-heartbeat</code></p></li>
<li><strong>port</strong> : <em>( <code>Number</code> optional: default = <code>6379</code> )</em> Redis port. Passed directly to <code>redis-heartbeat</code></li>
<li><strong>options</strong> : <em>( <code>Object</code> optional: default = <code>{}</code> )</em> Redis options. Passed directly to <code>redis-heartbeat</code></li>
<li><strong>client</strong> : <em>( <code>RedicClient</code> optional: default = <code>null</code> )</em> It also possible to pass in a already existing redis client instance. In this .case the options <code>host</code>, <code>port</code> and <code>options</code> ar ignored. Passed directly to <code>redis-heartbeat</code></li>
<li><strong>redisprefix</strong> : <em>( <code>String</code> optional: default = <code>{}</code> )</em> A general redis key prefix. Passed directly to <code>redis-heartbeat</code></li>
<li><strong>heartbeatOptions</strong> : <em>( <code>Object</code> optional: default = <code>{}</code> )</em> Optional <code>redis-heartbeat</code> options. <a href="https://github.com/mpneuried/redis-heartbeat#initialize">Details</a></li>
</ul>


<div class="pilwrap" id="methods">
  <h2>
    <a href="#methods" name="methods" class="pilcrow">&#182;</a>
    Methods
  </h2>
</div>



<div class="pilwrap" id=".start()">
  <h4>
    <a href="#.start()" name=".start()" class="pilcrow">&#182;</a>
    <code>.start()</code>
  </h4>
</div>


<p>Start checking the health of the server and connections</p>

<p><strong>Return</strong></p>

<p><em>( Systemhealth )</em>: The instance itself for chaining </p>


<div class="pilwrap" id=".stop()">
  <h4>
    <a href="#.stop()" name=".stop()" class="pilcrow">&#182;</a>
    <code>.stop()</code>
  </h4>
</div>


<p>Stop checking interval</p>

<p><strong>Return</strong></p>

<p><em>( Systemhealth )</em>: The instance itself for chaining </p>


<div class="pilwrap" id=".die()">
  <h4>
    <a href="#.die()" name=".die()" class="pilcrow">&#182;</a>
    <code>.die()</code>
  </h4>
</div>


<p>Mark the server as dead and stop the heartbeat.
    This is called until one check failed for <code>option.failCount</code> times.</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: Successful died. If the health is already <code>dead</code> it'll return <code>false</code></p>


<div class="pilwrap" id=".resurrect()">
  <h4>
    <a href="#.resurrect()" name=".resurrect()" class="pilcrow">&#182;</a>
    <code>.resurrect()</code>
  </h4>
</div>


<p>Resurrect the server and restart the heartbeat.
This is called until all checks are successful for <code>option.successCount</code> times.</p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: Successful died. If the health is already <code>dead</code> it'll return <code>false</code></p>


<div class="pilwrap" id=".getstate()">
  <h4>
    <a href="#.getstate()" name=".getstate()" class="pilcrow">&#182;</a>
    <code>.getState()</code>
  </h4>
</div>


<p>return the last check state.</p>

<p><strong>Return</strong></p>

<p><em>( Object )</em>: An object with the state of all checks. </p>

<p>Format: <code>{ "my-check-foo-name": [ {state}, {data} ] }</code>
<em>{state}</em>: Positive numbers represent the successful counts. Negative numbers represent the fail count. <br />
<em>{data}</em>: Optional data or error infos</p>


<div class="pilwrap" id="events">
  <h2>
    <a href="#events" name="events" class="pilcrow">&#182;</a>
    Events
  </h2>
</div>



<div class="pilwrap" id="started">
  <h4>
    <a href="#started" name="started" class="pilcrow">&#182;</a>
    <code>started</code>
  </h4>
</div>


<p>Emitted on a successfull start of the heartbeat after the frist check.</p>


<div class="pilwrap" id="stopped">
  <h4>
    <a href="#stopped" name="stopped" class="pilcrow">&#182;</a>
    <code>stopped</code>
  </h4>
</div>


<p>Emitted on a check stop.</p>


<div class="pilwrap" id="died">
  <h4>
    <a href="#died" name="died" class="pilcrow">&#182;</a>
    <code>died</code>
  </h4>
</div>


<p>Emitted on heartbeat stop. So the server/machine is defined as dead.</p>


<div class="pilwrap" id="resurrected">
  <h4>
    <a href="#resurrected" name="resurrected" class="pilcrow">&#182;</a>
    <code>resurrected</code>
  </h4>
</div>


<p>Emitted on restart of heartbeat. So the server/machine is defined as alive.</p>


<div class="pilwrap" id="checked">
  <h4>
    <a href="#checked" name="checked" class="pilcrow">&#182;</a>
    <code>checked</code>
  </h4>
</div>


<p>Emitted after a check</p>

<p><strong>Arguments</strong> </p>

<ul>
<li><strong>state</strong> : <em>( <code>Object</code> )</em> See method <code>.getState()</code> for teh description of the return</li>
</ul>


<div class="pilwrap" id="example">
  <h2>
    <a href="#example" name="example" class="pilcrow">&#182;</a>
    Example
  </h2>
</div>



<div class="highlight"><pre><code>  <span class="kd">var</span> <span class="nx">CHECKS</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s2">&quot;memcached&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
          <span class="kd">var</span> <span class="nx">Memcached</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;memcached&#39;</span> <span class="p">);</span>
          <span class="kd">var</span> <span class="nx">_client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Memcached</span><span class="p">();</span>
          <span class="k">return</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">cb</span> <span class="p">){</span>
              <span class="nx">_client</span><span class="p">.</span><span class="nx">version</span><span class="p">(</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">version</span> <span class="p">){</span>
                  <span class="k">if</span><span class="p">(</span> <span class="nx">err</span> <span class="p">){</span>
                      <span class="nx">cb</span><span class="p">(</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">err</span> <span class="p">);</span> <span class="c1">// do not return a regular error. Just return false as second arg and optinal info like the error object</span>
                  <span class="p">}</span>
                  <span class="nx">cb</span><span class="p">(</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="p">{</span> <span class="nx">_v</span><span class="o">:</span> <span class="nx">version</span> <span class="p">}</span> <span class="p">);</span> <span class="c1">// just return true and optional information, that will be logged to redis metics</span>
              <span class="p">});</span>
          <span class="p">}</span>
      <span class="p">},</span>
      <span class="s2">&quot;sql&quot;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
          <span class="kd">var</span> <span class="nx">_client</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s1">&#39;./my-sql-client42&#39;</span> <span class="p">);</span>
          <span class="k">return</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">cb</span> <span class="p">){</span>
              <span class="nx">_client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span> <span class="s2">&quot;SELECT 5&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">err</span><span class="p">,</span> <span class="k">return</span> <span class="p">){</span>
                  <span class="k">if</span><span class="p">(</span> <span class="nx">err</span> <span class="p">){</span>
                      <span class="nx">cb</span><span class="p">(</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">err</span> <span class="p">);</span> <span class="c1">// do not return a regular error. Just return false as second arg and optinal info like the error object</span>
                  <span class="p">}</span>
                  <span class="nx">cb</span><span class="p">(</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">true</span> <span class="p">);</span>
              <span class="p">});</span>
          <span class="p">}</span>
      <span class="p">}</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">Systemhealth</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span> <span class="s2">&quot;systemhealth&quot;</span> <span class="p">);</span>
  <span class="kd">var</span> <span class="nx">health</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Systemhealth</span><span class="p">(</span> <span class="p">{</span> <span class="nx">identifier</span><span class="o">:</span> <span class="s2">&quot;my-server-name&quot;</span> <span class="p">},</span> <span class="p">[</span> <span class="s2">&quot;memcached&quot;</span><span class="p">,</span> <span class="s2">&quot;sql&quot;</span> <span class="p">],</span> <span class="nx">CHECKS</span> <span class="p">);</span>
</code></pre></div>




<div class="pilwrap" id="properties">
  <h2>
    <a href="#properties" name="properties" class="pilcrow">&#182;</a>
    Properties
  </h2>
</div>



<div class="pilwrap" id="alive">
  <h4>
    <a href="#alive" name="alive" class="pilcrow">&#182;</a>
    <code>alive</code>
  </h4>
</div>


<p>If the service is alive this property will be <code>true</code></p>

<p><strong>Return</strong></p>

<p><em>( Boolean )</em>: If it's alive</p>


<div class="pilwrap" id="hb">
  <h4>
    <a href="#hb" name="hb" class="pilcrow">&#182;</a>
    <code>hb</code>
  </h4>
</div>


<p>The internally used instance of <a href="https://github.com/mpneuried/redis-heartbeat"><code>redis-heartbeat</code></a>.</p>

<p><strong>Return</strong></p>

<p><em>( Heartbeat )</em>: The redis heartbeat instance</p>


<div class="pilwrap" id="release%20history">
  <h2>
    <a href="#release%20history" name="release%20history" class="pilcrow">&#182;</a>
    Release History
  </h2>
</div>


<p>|Version|Date|Description|
|:--:|:--:|:--|
|0.0.3|2016-01-07|Updated dependencies|
|0.0.2|2015-03-11|Small bugfix within redis connection listening|
|0.0.1|2014-11-20|Initial commit|</p>


<div class="pilwrap" id="other%20projects">
  <h2>
    <a href="#other%20projects" name="other%20projects" class="pilcrow">&#182;</a>
    Other projects
  </h2>
</div>


<p>|Name|Description|
|:--|:--|
|<a href="https://github.com/mpneuried/redis-heartbeat"><strong>redis-heartbeat</strong></a>|Pulse a heartbeat to redis. This can be used to detach or attach servers to nginx or similar problems.|
|<a href="https://github.com/tcs-de/nodecache"><strong>node-cache</strong></a>|Simple and fast NodeJS internal caching. Node internal in memory cache like memcached.|
|<a href="https://github.com/smrchy/rsmq"><strong>rsmq</strong></a>|A really simple message queue based on Redis|
|<a href="https://github.com/mpneuried/nsq-logger"><strong>nsq-logger</strong></a>|Nsq service to read messages from all topics listed within a list of nsqlookupd services.|
|<a href="https://github.com/mpneuried/nsq-topics"><strong>nsq-topics</strong></a>|Nsq helper to poll a nsqlookupd service for all it's topics and mirror it locally.|
|<a href="https://github.com/mpneuried/nsq-nodes"><strong>nsq-nodes</strong></a>|Nsq helper to poll a nsqlookupd service for all it's nodes and mirror it locally.|
|<a href="https://github.com/mpneuried/nsq-watch"><strong>nsq-watch</strong></a>|Watch one or many topics for unprocessed messages.|
|<a href="https://github.com/smrchy/redis-sessions"><strong>redis-sessions</strong></a>|An advanced session store for NodeJS and Redis|
|<a href="https://github.com/mpneuried/connect-redis-sessions"><strong>connect-redis-sessions</strong></a>|A connect or express middleware to simply use the <a href="https://github.com/smrchy/redis-sessions">redis sessions</a>. With <a href="https://github.com/smrchy/redis-sessions">redis sessions</a> you can handle multiple sessions per user_id.|
|<a href="https://github.com/smrchy/task-queue-worker"><strong>task-queue-worker</strong></a>|A powerful tool for background processing of tasks that are run by making standard http requests.|
|<a href="https://github.com/mpneuried/soyer"><strong>soyer</strong></a>|Soyer is small lib for serverside use of Google Closure Templates with node.js.|
|<a href="https://github.com/mpneuried/grunt-soy-compile"><strong>grunt-soy-compile</strong></a>|Compile Goggle Closure Templates ( SOY ) templates inclding the handling of XLIFF language files.|
|<a href="https://github.com/mpneuried/backlunr"><strong>backlunr</strong></a>|A solution to bring Backbone Collections together with the browser fulltext search engine Lunr.js|</p>


<div class="pilwrap" id="the%20mit%20license%20(mit)">
  <h2>
    <a href="#the%20mit%20license%20(mit)" name="the%20mit%20license%20(mit)" class="pilcrow">&#182;</a>
    The MIT License (MIT)
  </h2>
</div>


<p>Copyright © 2013 Mathias Peter, <a href='http://www.tcs.de'>http://www.tcs.de</a></p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p></div>
  </div>
</body>
</html>
